\hypertarget{Freivalds}{}
\section{Вероятностные алгоритмы с односторонней ограниченной вероятностью ошибки. Алгоритм Фрейвальдса для проверки умножения матриц}

\secauthor{\ivan}

\subsection{Вероятностные алгоритмы с односторонней ограниченной вероятностью ошибки}

Нам надо что-то проверить. Придумываем алгоритм, который это проверяет, но может ошибиться в одну сторону. Более точно: если алгоритм отвечает ``да'', то это точно правильный ответ. Если же алгоритм отвечает ``нет'', то ответ может быть верным, а может быть --- нет. Ещё точнее, \emph{если правильный ответ ``нет'', алгоритм точно даст именно такой ответ; если же правильный ответ ``да'', то он выдаст (неправильный ответ) ``нет'' с вероятностью не более $1/2$.} Вместо $1/2$ здесь можно поставить любую константу, отличную от единицы, так как многократными повторениями вероятность ошибки можно уменьшить: если изначальная вероятность ошибки  $p$, то после $k$ повторов вероятность ни разу не сказать ``да'' при правильном ответе ``да'' составит не более $p^k$. Естественно, испытания должны быть независимыми --- при каждом следующем запуске нужно использовать новые случайные числа.

\subsection{Алгоритм Фрейвальдса для проверки умножения матриц.}

Есть три матрицы: $A_{m,n}$, $B_{n,k}$ и $C_{m,k}$, хотим узнать, $A\times B=C$ или нет.

\begin{algodescription}{Решение за $O\left(\frac{mnk}{\min(m,n,k)}\right)$ операций над элементами матриц; вероятность ошибки $\le\frac{1}{2}$}

\begin{nb*}Если все матрицы $A$, $B$, $C$ квадратные, то мы проверим за $O(n^2)$, а если бы проверяли умножением матриц --- это $O(n^{2.8})$ (алгоритм Штрассена).
\end{nb*}

Сгенерируем случайный столбец $r$ длины $k$ из нулей и единиц (все равновероятно). Давайте проверять равенство $AB\times r=C\times r$; если умножать так: $A\times (B\times r)$, получится время $O(nk+mn+mk)=O\left(\frac{mnk}{\min(m,n,k)}\right)$, где каждое слагаемое есть время перемножения матриц $B\times r$, $A \times Br$ и $C\times r$.
\end{algodescription}

Очевидно, если $A\times B=C$, алгоритм так и сообщит. Следующая теорема~-- о том, с какой вероятностью алгоритм ошибется, сообщив о равенстве, когда его нет.

\begin{theorem*}
    При $A\times B \neq C$ для случайно выбранного вектора $r$ вероятность того, что $AB\times r = C\times r$, не превосходит $\frac{1}{2}$.
\end{theorem*}
\begin{proof}
Перепишем $ABr = Cr$ как $Xr=0$, $X=AB-C$. Посмотрим на какой-нибудь ненулевой элемент $x_{ab}$. Имеем:
$$\sum_{i=1, i\ne b}^{k} x_{ai}r_i+x_{ab}r_b=0$$
Из этого выражения однозначно определяется $r_b$. Это означает, что уже векторов $r$, удовлетворяющих $Xr=0$, не более $2^{k-1}$, а шанс выбрать такой вектор не превосходит $\frac{2^{k-1}}{2^k} = \frac{1}{2}$. Таким образом, вероятность ошибки $\le\frac{1}{2}$. \end{proof}
