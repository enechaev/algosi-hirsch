\let\bf\bfseries
\let\it\itshape
\section{(WIP)Алгоритм проталкивания предпотока (\groth)}
Этот алгоритм также находит максимальный поток, но отличается от предыдущих описанных алгоритмов тем, что не является вариантом алгоитма Форда-Фалкерсона, а также другой оценкой времени работы.
\begin{definition}
	{\bf\it Предпотоком} называется функция $f\colon V\times V\to\mathbb{R}$ на вершинах транспортной сети $G=\langle V,E\rangle,s,t$, для которой выполняются следующие свойства:
	\begin{enumerate}
		\item $\forall(u,v)\in V\times V\colon f(u,v)\le c(u,v)$
		\item $\forall(u,v)\in V\times V\colon f(u,v)=-f(v,u)$
		\item $\forall u\in V\smallsetminus\{s\}\colon \sum_{v\in V} f(v,u)\ge0$
	\end{enumerate}
	$e(u)=\sum_{v\in V} f(v,u)$ называется {\bf\it избыточным потоком}.
	
	Вершина $u\in V$ называется {\bf\it переполненной}, если $e(u)>0$.
\end{definition}
\begin{definition}
	Функция $h\colon V\to\mathbb{N}$ называется {\bf\it функцией высоты}, если выполняются следующие свойства:
	\begin{enumerate}
		\item $h(s)=|V|$
		\item $h(t)=0$
		\item $\forall (u,v)\in E_f\colon h(u)\le h(v)+1$
	\end{enumerate}
\end{definition}
\subsection{Интуитивные соображения}
Представим, что наша сеть~-- это система из резервуаров $V$, соединенных трубами $E$ и находящихся на разной высоте $h$. Предпоток~-- это жидкость, которая течет по трубам, но где-то ее втекает больше, чем вытекает, и она остается в резервуаре (мы предполагаем, что они бесконечные). Можно "перелить"(операция проталкивания) жидкость из резервуара в соединенные трубой резервуары (увеличить значение предпотока на смежных трубах, если выполняются соответствующие интуитивные условия: высота резервуара $u$, из которого переливают, должна быть на единицу больше высоты резервуара $v$, в который переливают, и $c_f(u,v)>0$), находящиеся на меньшей высоте или, если таких не найдется, "поднять"(операция поднятия) резервуар на высоту на единицу большую, чем самый нижний из смежных резервуаров.
	
Почти очевидно, что в таком случае предпоток превратится в поток. Как будет показано, он будет и максимальным.
	
\subsection{Операция проталкивания}
\begin{lstlisting}[escapeinside=``]
	function push(`$u,v\in V$`):
		if `$e(u)>0$` and `$c_f(u,v)>0$` and `$h(u)-h(v)=1$`:
			`$d$` := `$\min(e(u), c_f(u,v))$`
			`$f(u,v)$` += `$d$`
			`$f(v,u)$` := `$-f(u, v)$`
			`$e(u)$` -= `$d$`
			`$e(v)$` += `$d$`
\end{lstlisting}
Условие $h(u)-h(v)=1$ нужно, так как из отрицания пункта 3 условия на функцию высоты следует, что если высоты различаются больше чем на единицу, остаточных ребер просто нет, поэтому проталкивать что-либо бессмысленно.

Понятно, что предпоток после проталкивания остается предпотоком (сохранение свойств 1, 2 совсем очевидно, свойство 3 сохраняется, потому что мы вычитаем что-то, не превосходит $e(u)$\label{someshit7}).

Проталкивание называется {\bf\it насыщающим}, если после него $c_f(u,v)=0$ (ребро, соответственно, становится {\bf\it насыщенным}). Понятно, что после ненасыщающего проталкивания вершина $u$ перестает быть переполненной (мы так выбираем $d=\min(e(u), c_f(u,v))$, что зануляется либо переполненность, либо остаточная пропускная способность).

\begin{lemma}
	После проталкивания функция высоты остается функцией высоты (не нарушаются ее свойства).
\end{lemma}
\begin{proof}
	Так как высоты не меняются, нужно только проверить, что сохраняется условие 3. Операция может удалить ребро $(u,v)$ из $E_f$ (если $c_f(u,v)<e(u)$) или добавить ребро $(v,u)$, если его не было (так как если $e(u)<c_f(u)$, то $с_{f_\mathrm{new}}(v,u)=с(v,u)+f_\mathrm{new}(u,v)>0=c_f(v,u)$). В первом случае удаление ребра делает неактуальным ограничение. Во втором случае выполняется $h(v)=h(u)+1$, поэтому $h(v)\le h(u)+1$. Поэтому $h$ остается функцией высоты.
\end{proof}
\subsection{Операция подъема}
\begin{lstlisting}[escapeinside=``]
	function relabel(`$u\in V$`):
		if `$e(u)>0$` and `$\forall(u,v)\in E_f\colon h(u)\le h(v)$`:
		`$h(u)$` += `$1+\min_{(u,v)\in E_f}\{h(v)\}$`
\end{lstlisting}
\begin{lemma}
	После подъема функция высоты остается функцией высоты (не нарушаются ее свойства).
\end{lemma}
\begin{proof}
	Докажем, что эта функция назначает наибольшую возможную высоту, удовлетворяющую условиям высоты. Так как вершина $u$ переполнена ($e(u)>0$), то существует вершина $v$, для которой $f(v,u)>0$, значит, $c_f(u,v)=c(u,v)-f(u,v)=c(u,v)+f(v,u)>0$, а значит, $(u,v)\in E_f$. Поэтому $\min_{(u,v)\in E_f}\{h(v)\}$ определено и это наибольшее возможное значение, удовлетворяющее условию 3.
	
	Понятно, что источник и сток выше поднять нельзя, рассмотрим другую вершину к $u$ и входящее в него ребро $(u,v)$. Поскольку высота строго увеличивается ($h(u)\le h(v)$ для всех $(u,v)\in E_f$ до поднятия, а значит, $h(u)<1+h(v)=h_\mathrm{new}(u)$ для такого смежного $v$, что $h(v)$ минимально), выполняется $h(w)\le h(u)+1\le h_{new}(u)+1$
\end{proof}

\subsection{Начальный предпоток}
Начальный предпоток определяется так:
$$
f(u,v)=\begin{cases}
	c(u,v), & u=s,\\
	-c(u,v), & v=s,\\
	0, & \mathrm{otherwise}
\end{cases}
$$
Начальный поток определяется так:
$$
h(u)=\begin{cases}
|V|, & u=s,\\
0, & \mathrm{otherwise}
\end{cases}
$$
Это действительно корректно определенная функция высоты, поскольку единственные ребра, для которых не выполняется условие 3~-- это ребра, выходящие из источника, но так как для них значение предпотока равно значению пропускной способности, их нет в $E_f$.
\begin{lstlisting}[escapeinside=``]
	function init_preflow(`$G=\langle V,E\rangle,s$`):
		foreach `$v\in V\smallsetminus\{s\}$`:
			`$h(u)$`:=`$0$`
			`$e(u)$`:=`$0$`
		foreach `$(u,v)\in E$`:
			`$f(u,v)$`:=`$0$`
			`$f(v,u)$`:=`$0$`
		`$h(s)$`:=`$|V|$`
		foreach `$(s,u)\in E$`:
			`$f(s,u)$` := `$c(s,u)$`
			`$f(u,s)$` := `$-c(s,u)$`
			`$e(u)$` := `$c(s,u)$`
			`$e(s)$` -= `$c(s,u)$`
\end{lstlisting}

\subsection{Алгоритм. Его корректность.}
Для начала нужно доказать лемму:
\begin{lemma}\label{someshit8}
	Пусть $G,s,t$~-- транспортная сеть с предпотоком $f$ и какой-то функцией высоты $h$. Тогда к любой переполненной вершине можно применить либо проталкивание, либо подъем.
\end{lemma}
\begin{proof}
	Для $(u,v)\in E_f$ выполняется $h(u)\le h(v)+1$ (по условию на высоту). Если $h(u)-h(v)=1$ для какой-то вершины $v$, то выполняется операция проталкивания, а иначе $h(u)<h(v)+1\Rightarrow h(u)\le h(v)$ $\forall (u,v)\in E_f$, а значит, выполнима операция подъема.
\end{proof}
Понятно, что они не могут быть выполнены одновременно.

Теперь мы можем написать алгоритм:
\begin{lstlisting}[escapeinside=``]
	function PPA(`$G,s,t$`):
		init_preflow(`$G,s$`)
		while `$\exists u\colon\left(\exists v\in V\colon\mathrm{Pushable}(u,v)\right)\wedge\mathrm{Relabelable}(u)$`:
			if `$\mathrm{Pushable}(u,v)$`:
				push(`$u,v$`)
			else: relabel(`$u$`)
\end{lstlisting}

\begin{lemma}\label{someshit9}
	$G=\langle V,E\rangle,s,t,f,h$~--- транспортная сеть с источником, стоком, предпотоком и функцией высоты. Тогда нет пути из источника в сток в $G_f$.
\end{lemma}
\begin{proof}
	Предположим, что существует такой путь $v_0=s\to v_1\to\cdots\to v_{k-1}\to t=v_k, (v_i,v_i+1)\in E_f$. 
	Можно считать, что этот путь простой, а поэтому $k<|V|$.
	Кроме того, $h(v_i)\le h(v_{i+1})\forall 0\le i\le k-1$. Но, сложив все эти неравенства, мы получим, что $h(s)\le h(t)+k\Rightarrow |V|\le 0+k$. Противоречие.
\end{proof}
\begin{theorem} {\bf (О корректности)}
	После окончания работы алгоритма $f$ становится максимальным потоком.
\end{theorem}
\begin{proof}
	Понятно, что $f$, инициализированный в initialize\_preflow, является предпотоком.
	
	В процессе выполнения алгоритма производятся операции проталкивания и поднятия, которые, как мы уже знаем, оставляют $f$ и $h$ предпотоком и функцией высоты.
	
	После окончания работы все вершины, кроме $s$ и $t$ должны иметь избыточный поток 0 (по лемме~\ref{someshit8}). Поэтому это поток. По лемме~\ref{someshit9} нет пути из источника в сток, а значит по теореме~\ref{maxflowmincut} этот поток~--- максимальный.
\end{proof}